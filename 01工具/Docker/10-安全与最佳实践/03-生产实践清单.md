# 生产实践清单 (Production Checklist)

## 适用场景
- 深度学习模型服务上线前的最后检查。
- 确保服务的稳定性、安全性和可维护性。

## 1. 镜像 (Image)
- [ ] **固定 Tag**: 永远不要在生产环境使用 `latest`。使用具体的版本号（如 `v1.2.0`）或 SHA 哈希。
- [ ] **最小化基础镜像**: 生产环境使用 `runtime` 或 `slim` 镜像，不要带编译器和构建工具。
- [ ] **多阶段构建**: 确保最终镜像只包含运行所需的 Artifacts。
- [ ] **安全扫描**: 使用 `docker scan my-image` 检查已知漏洞。

## 2. 容器运行时 (Runtime)
- [ ] **资源限制**: 必须设置 CPU 和 内存限制，防止单个容器耗尽宿主机资源（OOM）。
  ```yaml
  deploy:
    resources:
      limits:
        cpus: '4.0'
        memory: 8G
  ```
- [ ] **重启策略**: 设置 `restart: always` 或 `unless-stopped`，确保宕机自动拉起。
- [ ] **健康检查 (Healthcheck)**: 配置 `HEALTHCHECK` 指令，让 Docker 知道服务是否真的可用（不仅仅是进程在跑）。
  ```yaml
  healthcheck:
    test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
    interval: 30s
    timeout: 10s
    retries: 3
  ```

## 3. 日志 (Logging)
- [ ] **日志轮转 (Log Rotation)**: 默认 Docker 不会清理日志，会导致磁盘爆满。
  ```yaml
  logging:
    driver: "json-file"
    options:
      max-size: "100m"
      max-file: "3"
  ```
- [ ] **标准输出**: 应用日志应输出到 `stdout/stderr`，不要写死在容器内文件里。

## 4. 网络与安全 (Network & Security)
- [ ] **最小端口暴露**: 只映射必要的端口（如 80/443），数据库端口（5432/6379）不要映射到宿主机公网，仅在 Docker 网络内部互通。
- [ ] **非 Root 运行**: 尽可能使用非 Root 用户运行业务进程。
- [ ] **只读文件系统**: 对于不需要写入的容器，开启 Read-only 模式。

- 数据：volume 备份、灾备

## TODO
- [ ] 写一份“上线前 20 条检查清单”
