# 开发环境模板 (Compose 组合)

## 适用场景
- 快速拉起一套完整的开发环境。
- **重点**: 深度学习全栈环境 (Jupyter + TensorBoard + 监控)。

## 1. 深度学习全栈模板 (AI Stack)
这个模板会启动：
1.  **JupyterLab**: 交互式开发，挂载 GPU。
2.  **TensorBoard**: 实时查看训练日志。
3.  **共享存储**: 两个服务共享日志目录。

创建 `compose.yaml`:

```yaml
name: dl-project

services:
  # 1. 主开发环境
  lab:
    image: pytorch/pytorch:2.0.1-cuda11.7-cudnn8-runtime
    container_name: my-lab
    restart: unless-stopped
    ports:
      - "8888:8888"
    volumes:
      - ./workspace:/workspace  # 代码目录
      - ./data:/data:ro         # 数据集 (只读)
      - ./logs:/logs            # 日志目录 (共享)
    environment:
      - JUPYTER_TOKEN=mytoken123 # 设置 Jupyter 密码
    working_dir: /workspace
    command: jupyter lab --ip=0.0.0.0 --allow-root --no-browser
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

  # 2. 可视化监控
  tensorboard:
    image: tensorflow/tensorflow:2.12.0-gpu # 或者直接用 pytorch 镜像装个 tb
    container_name: my-tensorboard
    restart: unless-stopped
    ports:
      - "6006:6006"
    volumes:
      - ./logs:/logs:ro         # 只读挂载日志
    command: tensorboard --logdir=/logs --host=0.0.0.0

  # 3. (可选) 显卡监控
  # 需要宿主机支持
  # nvtop: ...
```

### 使用方法
1. 创建目录：`mkdir workspace data logs`
2. 启动：`docker compose up -d`
3. 访问：
   - Jupyter: `http://localhost:8888` (Token: `mytoken123`)
   - TensorBoard: `http://localhost:6006`

## 2. Web 开发通用模板 (Web + DB + Redis)
适合后端开发。

```yaml
services:
  web:
    build: .
    ports:
      - "8000:8000"
    depends_on:
      - db
      - redis
    environment:
      - DB_HOST=db
      - REDIS_HOST=redis

  db:
    image: postgres:15-alpine
    environment:
      POSTGRES_PASSWORD: example
    volumes:
      - db-data:/var/lib/postgresql/data

  redis:
    image: redis:alpine

  # 数据库管理界面 (可选)
  adminer:
    image: adminer
    ports:
      - "8080:8080"

volumes:
  db-data:
```


## TODO
- [ ] 每个模板只保留最小可用字段（先占位）
