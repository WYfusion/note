# 移动文件夹操作指南 (Linux & Windows)

本指南详细介绍了在 Linux/macOS 和 Windows 环境下移动文件夹的常用命令、参数详解及场景示例。

---

## 1. Linux / macOS (`mv`)

`mv` (Move) 是类 Unix 系统中最基本的移动和重命名命令。

### 基本语法
```bash
mv [选项] <源路径> <目标路径>
```

### 关键参数详解

| 功能 | 参数 | 说明 |
| :--- | :--- | :--- |
| **覆盖控制** | `-f` (force) | **强制覆盖**目标位置的同名文件/文件夹，不进行提示。 |
| | `-i` (interactive) | **交互模式**。如果目标已存在，会询问是否覆盖。 |
| | `-n` (no-clobber) | **不覆盖**。如果目标已存在，则跳过不移动。 |
| **递归** | (默认) | `mv` 对文件夹默认进行递归处理，无需额外参数。 |
| **详细信息** | `-v` (verbose) | 显示移动过程的详细信息。 |

### 场景示例

#### 场景 A: 简单移动（重命名）
将 `data` 文件夹重命名为 `backup`。
```bash
mv data backup
```

#### 场景 B: 移动到已有目录
将 `images` 文件夹移动到 `assets` 目录中（结果路径：`assets/images`）。
```bash
mv images assets/
```

#### 场景 C: 强制覆盖且显示过程
将 `update_pkg` 移动到 `deploy` 目录，如果存在则直接覆盖，并显示过程。
```bash
mv -vf update_pkg deploy/
```

#### 关于权限与跨文件系统
*   **同分区移动**：`mv` 仅修改文件系统索引（inode 指向），速度极快，**权限、时间戳完美保留**。
*   **跨分区移动**：`mv` 会自动执行“复制+删除”操作。在此过程中，通常会尝试保留元数据，但某些特殊属性（如 SELinux 上下文）可能需要额外注意。

---

## 2. Windows CMD (`robocopy`)

`robocopy` (Robust File Copy) 是 Windows 中最强大的文件复制/移动工具，特别适合处理**大量文件**、**断点续传**和**权限保留**。

> **注意**：`robocopy` 本质是复制工具，使用 `/MOVE` 参数来实现“移动”（即复制成功后删除源）。

### 基本语法
```cmd
robocopy <源路径> <目标路径> [文件筛选] [选项]
```

### 关键参数详解

| 功能 | 参数 | 说明 |
| :--- | :--- | :--- |
| **移动模式** | `/MOVE` | 移动文件和目录（复制后从源中删除）。 |
| | `/MOV` | 仅移动文件（不删除源目录结构）。 |
| **递归** | `/E` | 递归复制/移动所有子目录，包括**空目录**。 |
| | `/S` | 递归复制/移动子目录，但不包括空目录。 |
| **保留属性** | `/COPYALL` | 复制所有文件信息（数据、属性、时间戳、**ACL安全设置**、所有者、审计信息）。相当于 `/COPY:DATSOU`。 |
| | `/DCOPY:T` | 复制目录的时间戳（非常重要，默认可能不保留目录时间）。 |
| **重试机制** | `/R:n` | 失败时的重试次数（默认为 1百万次，建议设为 `/R:3`）。 |
| | `/W:n` | 重试之间的等待秒数（建议 `/W:5`）。 |

### 场景示例

#### 场景 A: 完整移动文件夹（推荐标准用法）
将 `C:\Project` 移动到 `D:\Backup`，保留所有权限和目录结构，并处理空文件夹。
```cmd
robocopy "C:\Project" "D:\Backup" /E /MOVE /COPYALL /DCOPY:T /R:3 /W:5
```

#### 场景 B: 仅移动内容，不保留源文件夹
`robocopy` 的特性是它处理的是“文件夹内容”。上述命令会将 `Project` 下的内容移动到 `Backup` 下。
如果 `Backup` 不存在，它会创建。

---

## 3. Windows PowerShell (`Copy-Item` / `Move-Item`)

PowerShell 提供了更现代的动词-名词结构命令。

### 3.1 使用 `Move-Item` (推荐用于简单移动)
`Move-Item` (别名 `mv`, `move`) 是标准的移动命令。

#### 关键参数
*   `-Force`: 强制移动（覆盖现有文件，或移动只读文件）。
*   `-Path`: 源路径。
*   `-Destination`: 目标路径。

#### 示例
```powershell
# 将 Log 文件夹移动到 Archive 目录
Move-Item -Path ".\Log" -Destination ".\Archive" -Force
```

### 3.2 使用 `Copy-Item` + `Remove-Item` (手动移动)
虽然 `Move-Item` 很方便，但在某些复杂场景（如需要精细控制复制过程、验证哈希后再删除源、或者 `Move-Item` 跨卷失败）时，手动“复制后删除”更稳妥。

#### 基本语法
```powershell
Copy-Item -Path <源> -Destination <目标> -Recurse [选项]
```

#### 关键参数详解

| 功能 | 参数 | 说明 |
| :--- | :--- | :--- |
| **递归** | `-Recurse` | **必须加**。否则只复制文件夹本身（空壳），不包含内容。 |
| **覆盖** | `-Force` | 强制覆盖目标位置的文件。 |
| **保留容器** | `-Container` | 默认为 True。通常保持默认即可。 |
| **透传对象** | `-PassThru` | 输出复制后的对象结果，方便后续管道操作。 |

#### 场景示例：模拟移动并保留结构
将 `Src` 复制到 `Dst`，确认无误后删除 `Src`。

```powershell
# 1. 递归复制
Copy-Item -Path "C:\Src" -Destination "D:\Dst" -Recurse -Force

# 2. (可选) 验证或手动检查...

# 3. 删除源
Remove-Item -Path "C:\Src" -Recurse -Force
```

---

## 总结：该用哪个？

| 场景 | 推荐命令 | 原因 |
| :--- | :--- | :--- |
| **Linux / Mac 常规使用** | `mv` | 简单、标准、速度快。 |
| **Windows 简单移动** | PowerShell `Move-Item` | 语法直观，适合脚本化。 |
| **Windows 大文件/保留权限** | CMD `robocopy /MOVE` | **最稳健**。支持断点、详细日志、完美保留 ACL 权限和时间戳。 |
| **需要先复制备份再删除** | PowerShell `Copy-Item` | 逻辑分离，安全性最高（防止移动中途失败导致数据丢失）。 |
