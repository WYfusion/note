以下是基于文档《Adaptive energy detection for bird sound detection in complex environments.pdf》的**自适应能量检测（AED）流程**的完整公式推导与详细说明，严格遵循文档内容并标注对应段落编号。
## 一、传统能量检测（ED）的局限性与观测模型
#### 1. 观测信号模型
假设观测信号为离散时间信号，分为两种情况：
$$Y(n) = \begin{cases} W(n) & \text{无信号（$H_0$）} \\ S(n) + W(n) & \text{有信号（$H_1$）} \end{cases}, \quad n=1,2,\dots,N$$
其中：
- $Y(n)$：含噪观测信号
- $S(n)$：纯净鸟声信号（前景信号）
- $W(n)$：背景噪声
- $H_0$：“信号不存在” 假设，$H_1$：“信号存在” 假设
#### 2. 能量计算
信号在特定时间内的累积能量为：$E = \sum_\limits{n=1}^{N} [Y(n)]^2$ 其中，N为帧长（样本数）。
#### 3. 传统能量检测决策规则
通过能量与阈值比较判断信号存在性：$\frac{E}{\sigma_w^2} \begin{cases} < \lambda & H_0 \\ > \lambda & H_1 \end{cases}$ 其中：
- $\sigma_w^2$：噪声方差（需 priori 已知）
- $\lambda$：固定检测阈值
**局限性**：实际中噪声方差未知且非平稳，固定阈值无法适应环境变化。
## 二、自适应能量检测（AED）核心流程
AED 通过**噪声方差自适应估计**和**多频段概率阈值调整**解决传统 ED 的缺陷，流程分为以下步骤：
#### 步骤 1：噪声方差估计
目标：从含噪信号中实时估计噪声功率谱$\omega(f,k)$和方差$\hat{\sigma}_w^2$。
##### 1.1 平滑功率谱计算
对含噪信号进行 FFT 后，采用一阶递归平滑估计功率谱：$C(f,k) = \eta C(f-1,k) + (1-\eta)|Y(f,k)|^2$ 其中：
- $f$：帧索引，$k$：频率索引
- $|Y(f,k)|^2$：当前帧的功率谱
- $\eta=0.8$：平滑因子（实验设定），抑制高频波动
##### 1.2 局部最小值搜索（双向搜索）
通过前向和后向搜索确定功率谱的局部最小值，以区分噪声与信号：$C_{\text{min}}(f,k) = \max\left\{ \min_{f-Z+1 \leq f' \leq f} C(f',k), \min_{f \leq f' \leq f+Z-1} C(f',k) \right\}$ 其中：
- Z：搜索帧数（文档未明确取值，需通过上下文理解为经验值）
- 取前向和后向最小值中的较大者，避免低估噪声功率
##### 1.3 信号存在性判断
通过功率谱与局部最小值的比值判断当前频率点是否存在信号：$I(f,k) = \begin{cases} 1 & \frac{C(f,k)}{C_{\text{min}}(f,k)} > \delta(k) \quad \text{（信号存在）} \\ 0 & \text{否则（噪声主导）} \end{cases}$ 其中，$\delta(k)$为频率相关决策系数，根据频段不同取值：
$$\delta(k) = \begin{cases} 1.5 & \text{低频（$1 \leq k \leq LF$）} \\ 2 & \text{中频（$LF < k \leq MF$）} \\ 5 & \text{高频（$MF < k \leq 0.5F_s$）} \end{cases}$$
**设计逻辑**：高频段鸟声更集中，设更高阈值（如 5）以减少虚警。
##### 1.4 信号存在概率递归更新
通过递归平滑计算信号存在概率$P(f,k)$：$P(f,k) = \alpha_p P(f-1,k) + (1-\alpha_p)I(f,k)$ 其中：
- $\alpha_p=0.2$：平滑常数，控制历史概率与当前观测的权重
- 初始值$P(0,k)=0$，表示初始时假设无信号
##### 1.5 时间 - 频率平滑因子
结合信号存在概率生成自适应平滑因子：$\alpha_s(f,k) = \alpha_d + (1-\alpha_d)P(f,k)$ 其中：
- $\alpha_d=0.85$：基础平滑常数，取值范围$\alpha_d \leq \alpha_s \leq 1$
- 当$P(f,k)=1$（确信有信号）时，$\alpha_s=1$，停止平滑（保留信号细节）
##### 1.6 噪声功率谱估计
根据平滑因子更新噪声功率谱估计：$\varpi(f,k) = \begin{cases} C_{\text{min}}(f,k) & C_v(f,k) > c \text{ 或 } C_v(f,k) < 1/c \\ \alpha_s(f,k)\varpi(f-1,k) + (1-\alpha_s(f,k))|Y(f,k)|^2 & \text{否则} \end{cases}$ 其中：
- $C_v(f,k) = C_{\text{min1}}(f,k)/C_{\text{min2}}(f,k)$：衡量噪声功率谱变化的参数
- $c=1.25$：决策常数，当$C_v$超出$[1/c, c]$时，认为噪声突变，直接采用局部最小值$C_{\text{min}}$
##### 1.7 噪声方差计算
对噪声功率谱进行补偿并求和，得到噪声方差估计：$\omega(f,k) = \frac{\varpi(f,k)}{\beta}, \quad \beta=1.4 \text{（补偿因子，平衡噪声抑制与信号失真）}$$\hat{\sigma}_w^2 = \sum_f \sum_k \omega(f,k)$
#### 步骤 2：多频段自适应阈值确定
目标：根据不同频段的信号存在概率，动态调整检测阈值$\lambda_i$。
##### 2.1 频段划分
将频谱划分为 3 个非重叠线性频段（基于鸟类声音频率分布）：$i = \begin{cases} 1 & F(f) \leq 1 \text{ kHz} \quad \text{（低频段，噪声主导）} \\ 2 & 1 \text{ kHz} < F(f) \leq 0.5F_s - 2.5 \text{ kHz} \quad \text{（中频段）} \\ 3 & F(f) > 0.5F_s - 2.5 \text{ kHz} \quad \text{（高频段，鸟声主导）} \end{cases}$ 其中，$F_s$为采样率（文档中取$F_s=11025$ Hz）。
##### 2.2 频段信号存在概率
计算第i个频段的整体信号存在概率：$P_i = \frac{\sum_f p_i(f,k)}{\sum f}, \quad p_i(f,k) \in \{0,1\} \text{（频段内所有频率点的平均概率）}$
##### 2.3 自适应阈值推导
将检测概率$P_D$设为频段信号存在概率$P_i$，根据高斯分布特性推导阈值：$\lambda_i = (1+\text{SNR})\left( N + \sqrt{2N} Q^{-1}(P_i) \right)$ 其中：
- $\text{SNR} = \sigma_s^2/\sigma_w^2$：信噪比（实际中通过噪声估计间接适配）
- $Q^{-1}(x)$：标准高斯互补累积分布函数的逆函数
##### 2.4 最终决策规则
结合各频段的噪声方差估计$\hat{\sigma}_{i,w}^2$和自适应阈值$\lambda_i$，得到 AED 决策规则：$\frac{E}{\hat{\sigma}_{i,w}^2} \begin{cases} < \lambda_i & H_0 \\ > \lambda_i & H_1 \end{cases}$
### 三、AED 流程总结
1. **输入**：含噪鸟声信号$Y(n)$
2. **噪声方差估计**：
    - 递归平滑功率谱$C(f,k)$
    - 双向搜索确定局部最小值$C_{\text{min}}(f,k)$
    - 计算信号存在概率$P(f,k)$与噪声功率谱$\omega(f,k)$
3. **频段划分与阈值自适应**：
    - 分为低、中、高 3 个频段，计算各频段信号存在概率$P_i$
    - 推导自适应阈值$\lambda_i$，实现分频段检测
4. **输出**：检测结果（$H_0$或$H_1$），提取含鸟声的信号片段
### 四、关键公式与段落对应关系

|公式用途|公式编号|文档段落标记|
|---|---|---|
|观测信号模型|(1)||
|能量计算|(2)||
|传统 ED 决策规则|(3)||
|平滑功率谱|(11)||
|局部最小值搜索|(12)||
|信号存在性判断|(13)||
|信号存在概率更新|(15)||
|时间 - 频率平滑因子|(16)||
|噪声功率谱估计|(17)||
|噪声方差计算|(18)(19)||
|频段划分|(20)||
|自适应阈值推导|(23)||
|AED 决策规则|(24)||

### 五、AED 的核心优势
1. **无需先验噪声知识**：通过递归平滑和双向搜索实时估计噪声特性。
2. **多频段适应性**：高频段采用高检测阈值，低频段抑制噪声，匹配鸟声频率分布。
3. **非平稳噪声鲁棒性**：通过信号存在概率和自适应平滑因子，适应噪声的时频变化。
4. **低 SNR 性能**：在 0 dB 信噪比下仍能有效检测鸟声（文档实验显示 AED_MWSCC 准确率 58.18%）。
通过上述流程，AED 实现了复杂环境中鸟声信号的自适应检测，为后续特征提取和分类提供了可靠基础。