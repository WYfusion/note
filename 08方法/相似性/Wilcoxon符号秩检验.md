
### 一、定义与原理

Wilcoxon符号秩检验是在成对观测数据的符号检验基础上发展起来的，它克服了符号检验只考虑数据变化方向而不考虑变化幅度的局限。该方法通过比较成对观测数据之差与零的关系，来检验这些差值是否来自均值为0的总体，即检验产生数据的总体是否具有相同的均值。

### 二、检验步骤

1. **提出原假设**：设定要检验的原假设，例如两个相关样本的中位数是否存在差异，一般设原假设为两个相关样本不存在差异。
2. **计算差值**：分别用第二组样本观察值减去第一组对应样本的观察值，得到差值序列。
3. **忽略零差值**：对于差值为0的样本，可以忽略不计，因为它们不影响检验统计量的计算。
4. **排序与赋秩**：对剩余的非零差值按照绝对值大小进行排序，并赋予相应的秩（即排名等级，最小的差值分配为等级1，第二小的分配为等级2，以此类推）。如果差值有相同的绝对值，则取平均秩（它们的秩次为这两个差值在排序后位置的平均值）。
5. **加权求和**：根据差值的正负符号对秩进行加权求和，得到正秩和（W+）和负秩和（W-）。
6. **计算统计量**：根据W+和W-的值，计算检验统计量。这通常涉及到查找Wilcoxon符号秩检验的分布表或使用统计软件来得到在零假设下的p值。
7. **判断结果**：根据得到的p值与给定的显著性水平（如0.05）进行比较。如果p值较小（小于或等于显著性水平），则可以拒绝零假设；如果p值较大，则没有充分的证据来拒绝零假设。

### 三、适用场景

Wilcoxon符号秩检验适用于以下场景：

1. 比较两组相关样本的分布是否一致，例如比较某药物治疗前后患者的病情变化、比较同一个人在不同条件下的表现差异或比较同一测量指标在不同时间点下的数值变化。
2. 当数据不满足正态分布时，t检验不再适用，而Wilcoxon符号秩检验作为非参数检验方法，不受正态分布的限制，可以用于分析非正态分布数据。
3. Wilcoxon符号秩检验对离群值不敏感，即使数据中存在少量离群值，也不会对检验结果造成太大影响。

### 四、注意事项

1. Wilcoxon符号秩检验需要假定样本点来自连续对称总体分布。
2. 该检验方法只能比较两个相关样本的中位数差异，无法分析样本的其他特征，如方差、偏度等。
3. 当样本量较小时，Wilcoxon符号秩检验的检验功效可能会降低。
4. 由于它主要依赖于样本数据的秩次信息，因此当样本数据中存在大量相同或相近的数值时，秩次的分配可能会变得复杂且不准确。这进一步限制了Wilcoxon检验在分析样本其他特征方面的能力。

### 示例

假设有以下差值序列：-2, 1, -1, 3, -2, 0。

1. **排序**：-2, -2, -1, 0, 1, 3。
2. **秩次分配**：1, 2, 3, 4, 5, 6。
3. **处理相同差值**：由于有两个-2，它们的秩次取平均值为(1+2)/2=1.5。但为了方便计算，通常在实际操作中，我们会将相同差值的秩次分配为相邻的整数（如1和2），或者将它们视为一个整体并分配一个平均秩次（如在这个例子中，我们可以将两个-2都视为秩次1.5，但在计算秩和时，我们会将它们的秩次相加，即1.5+1.5=3）。然而，在标准的Wilcoxon符号秩检验中，更常见的做法是将相同差值的秩次分配为相邻的整数（或最接近的整数），以避免小数秩次带来的复杂性。因此，在这个例子中，我们可以将第一个-2分配为秩次1，第二个-2分配为秩次2（尽管这略微偏离了平均秩次的概念，但它是Wilcoxon符号秩检验中常用的简化方法）。
4. **计算正负差值秩和**：
   - 正差值秩和：5+6=11（因为只有1和3是正差值，它们的秩次分别为5和6）。
   - 负差值秩和：1+2+3+4=10（因为-2,-2,-1,0是负差值或零差值，但零差值通常不计入负差值秩和，所以这里只考虑-2,-2,-1的秩次）。但请注意，根据标准的Wilcoxon符号秩检验方法，零差值应该被忽略不计，因此我们实际上只计算非零负差值的秩和。在这个例子中，如果我们按照标准的平均秩次方法（即将两个-2视为一个整体并分配平均秩次），则负差值秩和的计算会略有不同。然而，为了简化说明，这里我们采用了将相同差值分配为相邻整数的简化方法。

需要注意的是，上述示例中的负差值秩和计算是基于一种简化的理解，并且没有严格按照平均秩次的方法来处理相同差值。在实际应用中，应严格按照Wilcoxon符号秩检验的标准方法来计算秩和。