CATREG 就是用来分析 “哪些因素（可以是类别或数字）会影响一个分类 / 等级的结果，以及每个因素的不同类别对结果的影响有多大” 的工具

---
#### 一、核心定义与本质
**CATREG（Categorical Regression）** 是一种用于分析**分类因变量**与**分类 / 连续自变量**之间关系的回归分析方法，属于广义线性模型的扩展。其核心是通过对分类变量（名义 / 有序）进行**最优尺度量化（Optimal Scaling）**，将非线性关系转化为线性模型，从而拟合变量间的关联。
#### 二、适用变量类型

| 变量类型     | 自变量（X）         | 因变量（Y）           |
| -------- | -------------- | ---------------- |
| **名义变量** | 支持（如 “性别”“地区”） | 支持（无序分类，如 “职业”）  |
| **有序变量** | 支持（如 “教育水平”）   | 支持（等级数据，如 “满意度”） |
| **连续变量** | 支持（直接纳入模型）     | 不支持（必须为分类变量）     |

#### 三、核心原理：最优尺度量化与线性模型构建
CATREG 的核心逻辑是通过**变量转换**将分类数据转化为适合线性回归的数值型数据，核心步骤如下：
##### 1. 因变量（Y）的处理
- **无序分类因变量**：  
    假设因变量有 k 个类别，CATREG 采用**虚拟编码**（Dummy Coding）或**多项式对比**（Polynomial Contrasts），将其转化为 k−1 个二元指标变量。模型输出每个类别相对于参考类别的效应。
- **有序分类因变量**：  
    假设因变量类别具有顺序（如 “低 - 中 - 高”），CATREG 为每个类别分配**有序得分（Ordinal Scores）**，通常假设得分间存在等距或单调递增关系，使用 **累积对数模型**（Cumulative Logit Model） 或线性趋势模型拟合。
##### 2. 自变量（X）的最优尺度变换
对于分类自变量（名义 / 有序），CATREG 通过**最优尺度法**将其转换为数值得分，使得转换后变量与因变量的关系尽可能线性化：
- **名义变量（如 “性别”：男 / 女）**：  
    生成虚拟变量（如男 = 1，女 = 0），或通过 **效应编码**（Effect Coding） 使参考类别得分均值为 0，便于比较组间差异。
- **有序变量（如 “教育水平”：小学 / 中学 / 大学）**：  
    分配等距得分（如 1, 2, 3）或通过数据驱动的**加权得分**（Weighted Scores），使得分与因变量的关联最大化（如大学 = 3，中学 = 1.5，小学 = 0.5）。
- **连续变量**：直接纳入模型，无需转换，但可通过分段处理转化为分类变量。
##### 3. 模型构建与估计
转换后的变量满足线性关系，构建回归方程：$\hat{Y}=\beta_0+\beta_1X_1^*+\beta_2X_2^*+\cdots+\beta_pX_p^*$​  
其中 $X_i^∗$​ 是自变量 $X_i​$ 的最优尺度得分，$β_i​$ 为回归系数，表示自变量对因变量的影响方向和强度。
- **估计方法**：采用**迭代广义最小二乘法**（Iterative Generalized Least Squares, IGLS）或**最大似然法**（ML），通过迭代优化变量得分和回归系数，最小化模型预测值与实际值的偏差（如离差损失函数）。
- **拟合优度**：使用伪 $R^2$（如 Cox & Snell、Nagelkerke）评估模型解释力，或通过分类准确率（针对无序因变量）判断预测效果
##### 4. 针对有序因变量的特殊处理（累积对数模型）

若因变量为有序分类（如 “不满意 - 一般 - 满意”），CATREG 假设存在潜在连续变量 $Y^∗$，观测到的类别由 $Y^∗$ 与阈值的比较决定：$Y=j$当且仅当$\tau_{j-1}<Y^*=\beta_0+\beta_1X_1^*+\cdots+\beta_pX_p^*\leq\tau_j$ 
其中 $\tau_j$ 为类别分界点，模型通过估计回归系数和阈值，描述自变量对 “高于某类别概率” 的影响。
#### 四、关键假设与模型性质
1. **线性关系假设**：  
    转换后的自变量与因变量（或潜在连续变量 $Y^∗$）呈线性关系。CATREG 通过最优尺度变换尽可能满足这一假设，但需注意变量间可能存在的交互作用。
2. **分类变量的独立性**：  
    名义自变量的类别间无内在顺序，有序自变量的得分需反映实际等级关系（若误将有序变量当作名义变量处理，可能损失信息）。
3. **权重与参考类别**：  
    名义变量的参考类别选择会影响系数解释（通常默认字母顺序或频率最高的类别为参考类），需根据研究问题合理设定。
#### 五、与其他方法的对比

| 方法                 | 因变量类型       | 自变量类型   | 核心特点                 |
| ------------------ | ----------- | ------- | -------------------- |
| **CATREG**         | 分类（名义 / 有序） | 分类 / 连续 | 自动处理分类变量量化，灵活支持多类型变量 |
| **Logistic 回归**    | 二分类         | 分类 / 连续 | 直接建模概率，适用于二分类因变量     |
| **多元 Logistic 回归** | 多分类（无序）     | 分类 / 连续 | 对比多个类别与参考类的概率比       |
| **有序 Logistic 回归** | 有序分类        | 分类 / 连续 | 假设比例优势，适用于等距有序因变量    |

#### 六、数学形式（以无序因变量为例）
假设因变量 $Y$ 有 $k$ 个类别，自变量包含 m 个名义变量和 n 个连续变量：
1. 对名义变量进行虚拟编码，生成 ($m_{\text{名义}}​−1$) 个哑变量；
2. 对有序变量分配得分 $s_j$​（如等距或数据驱动得分）；
3. 构建多元回归模型，因变量的每个类别对应一个方程，通过 softmax 函数计算类别概率  $P(Y=j)=\frac{\exp(\beta_{0j}+\sum\beta_{ij}X_i^*)}{\sum\limits_{l=1}^k\exp(\beta_{0l}+\sum\beta_{il}X_i^*)}$
    其中 $β_{0j}$​ 为类别基准效应，$β_{ij}$​ 为自变量对类别 $j$ 的影响系数。
#### 七、总结
CATREG 的核心是通过**数据驱动的变量量化**，将复杂的分类变量关系转化为线性模型，适用于探索多类型变量（尤其是分类变量）对分类因变量的影响。其优势在于无需手动编码虚拟变量，自动优化变量得分以拟合线性关系，但需注意变量类型的正确设定和模型假设的检验（如通过残差分析评估线性假设）。实际应用中，常作为探索性分析工具，为后续更复杂的模型（如结构方程模型）提供变量转换依据。



### 案例说明：用户满意度影响因素分析
#### 研究问题：
某电商平台想了解用户对购物体验的满意度等级（1 = 非常不满意，2 = 不满意，3 = 一般，4 = 满意，5 = 非常满意）与 “性别”（男 / 女）、“年龄组”（<25 岁，25-35 岁，>35 岁）、“购买金额”（连续变量）的关系。
#### 数据与模型设定：
- 因变量：有序分类变量（满意度等级 1-5）。
- 自变量：
    - 分类变量：性别（参考类别：男）、年龄组（参考类别：<25 岁）。
    - 连续变量：购买金额（假设存在非线性效应，拟合二次项）。
#### 关键结果解读：
1. **性别效应**：女性用户的满意度等级平均比男性高 0.8 个单位（p<0.05），说明性别对满意度有显著正向影响。
2. **年龄组差异**：
    - 25-35 岁组 vs <25 岁组：系数 1.2（p<0.01），满意度更高；
    - > 35 岁组 vs <25 岁组：系数 0.5（p>0.05），差异不显著。
3. **购买金额效应**：一次项系数 0.3（p<0.01），二次项系数 - 0.1（p<0.05），表明满意度随金额增加先上升后下降，峰值出现在 1500 元左右。
#### 结论：
平台应重点关注女性用户和 25-35 岁用户的体验，并优化高金额订单的服务流程以避免满意度下降。