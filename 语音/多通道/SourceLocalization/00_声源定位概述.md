# 声源定位 (Source Localization) 概述

## 目录导航

### 📚 基础理论
- [[01_声源定位数学基础]] - TDOA、DOA、几何关系
- [[02_声学传播模型]] - 远场、近场、混响

### 🔬 经典方法
- [[03_GCC-PHAT算法]] - 广义互相关相位变换
- [[04_SRP-PHAT算法]] - 可控响应功率
- [[05_MUSIC算法]] - 多重信号分类
- [[06_ESPRIT算法]] - 旋转不变子空间

### 🧠 深度学习方法
- [[07_DL_神经网络定位]] - CNN/RNN定位
- [[08_DL_端到端定位]] - 直接回归坐标

---

## 1. 什么是声源定位？

**声源定位 (Source Localization)** 是指利用麦克风阵列估计声源空间位置的技术。它是多通道音频处理的基础任务，为波束形成、语音增强等提供关键的先验信息。

### 1.1 定位参数

**方向角 (DOA - Direction of Arrival)**：
- 方位角 $\theta$：水平面角度
- 俯仰角 $\phi$：垂直面角度

**空间坐标**：
- 2D：$(x, y)$ 或 $(r, \theta)$
- 3D：$(x, y, z)$ 或 $(r, \theta, \phi)$

```
        z (俯仰)
        ↑
        |    🔊 声源
        |   /
        |  / r
        | /φ
        |/___θ___→ y (方位)
       /
      /
     x
```

### 1.2 基本原理

声波到达不同麦克风存在**时间差 (TDOA)** 或**相位差 (PDOA)**，通过几何关系可以反推声源位置。

---

## 2. 定位方法分类

### 2.1 按测量量分类

```
声源定位方法
├── 基于TDOA (Time Difference of Arrival)
│   ├── GCC-PHAT
│   ├── SRP-PHAT
│   └── 最大似然估计
│
├── 基于DOA (Direction of Arrival)
│   ├── MUSIC
│   ├── ESPRIT
│   └── 波束形成
│
├── 基于能量
│   ├── 能量衰减模型
│   └── 接收信号强度
│
└── 深度学习方法
    ├── 分类（角度离散化）
    ├── 回归（直接坐标）
    └── 混合方法
```

### 2.2 按阵列类型分类

| 阵列类型 | 定位能力 | 典型方法 |
|----------|----------|----------|
| **2麦克风** | 1D方向 | GCC-PHAT |
| **线性阵列** | 2D平面 | MUSIC, SRP |
| **平面阵列** | 3D空间 | SRP-PHAT, MUSIC |
| **3D阵列** | 3D空间 + 距离 | 多边定位 |

---

## 3. 核心概念

### 3.1 时间差 (TDOA)

声波到达麦克风 $i$ 和 $j$ 的时间差：

$$\tau_{ij} = \frac{d_i - d_j}{c}$$

其中：
- $d_i, d_j$：声源到麦克风的距离
- $c$：声速（≈343 m/s）

### 3.2 相位差 (PDOA)

频域中的相位差：

$$\Delta\phi_{ij}(f) = 2\pi f \tau_{ij}$$

**相位模糊性**：当 $|\Delta\phi| > \pi$ 时存在模糊。

### 3.3 远场假设

当声源距离 $r \gg D$（阵列孔径）时，可以假设平面波：

$$\tau_{ij} \approx \frac{d_{ij} \cos\theta}{c}$$

其中 $d_{ij}$ 是麦克风间距，$\theta$ 是到达角。

### 3.4 近场模型

近场时需要考虑球面波：

$$\tau_{ij} = \frac{\|\mathbf{r}_s - \mathbf{r}_i\| - \|\mathbf{r}_s - \mathbf{r}_j\|}{c}$$

其中 $\mathbf{r}_s$ 是声源位置，$\mathbf{r}_i, \mathbf{r}_j$ 是麦克风位置。

---

## 4. 主要方法

### 4.1 GCC-PHAT

**广义互相关相位变换 (Generalized Cross-Correlation with Phase Transform)**

**原理**：通过互相关找到时延，相位变换增强峰值。

**公式**：
$$R_{ij}(\tau) = \text{IFFT}\left\{\frac{X_i(f) X_j^*(f)}{|X_i(f) X_j^*(f)|}\right\}$$

**优点**：
- 简单高效
- 对混响有一定鲁棒性

**缺点**：
- 只能用于2麦克风
- 需要后续几何求解

### 4.2 SRP-PHAT

**可控响应功率 (Steered Response Power with Phase Transform)**

**原理**：在空间网格上搜索，使所有麦克风对的相位对齐能量最大的位置。

**公式**：
$$P(\mathbf{r}) = \sum_{i=1}^{P-1}\sum_{j=i+1}^{P} R_{ij}(\tau_{ij}(\mathbf{r}))$$

**优点**：
- 适用于任意阵列
- 鲁棒性好

**缺点**：
- 计算量大（网格搜索）
- 分辨率受限

### 4.3 MUSIC

**多重信号分类 (Multiple Signal Classification)**

**原理**：利用信号子空间和噪声子空间的正交性。

**公式**：
$$P_{\text{MUSIC}}(\theta) = \frac{1}{\mathbf{d}^H(\theta) \mathbf{U}_N \mathbf{U}_N^H \mathbf{d}(\theta)}$$

其中 $\mathbf{U}_N$ 是噪声子空间。

**优点**：
- 高分辨率
- 可以分辨多个源

**缺点**：
- 需要知道源数量
- 对相干源敏感
- 计算复杂度高

### 4.4 深度学习方法

**端到端学习**：
$$\hat{\mathbf{r}} = f_\theta(\mathbf{X})$$

其中 $f_\theta$ 是神经网络。

**优点**：
- 可以学习复杂的声学环境
- 端到端优化
- 可以处理混响和噪声

**缺点**：
- 需要大量标注数据
- 泛化能力依赖训练数据
- 可解释性差

---

## 5. 性能指标

### 5.1 定位误差

**角度误差**：
$$\epsilon_{\theta} = |\hat{\theta} - \theta_{\text{true}}|$$

**空间误差**：
$$\epsilon_r = \|\hat{\mathbf{r}} - \mathbf{r}_{\text{true}}\|$$

### 5.2 分辨率

能够区分的最小角度间隔：
$$\Delta\theta_{\min} \approx \frac{\lambda}{D}$$

其中 $\lambda$ 是波长，$D$ 是阵列孔径。

### 5.3 Cramér-Rao下界 (CRLB)

定位估计的理论下界：
$$\text{Var}(\hat{\theta}) \geq \text{CRLB}(\theta)$$

---

## 6. 影响因素

### 6.1 混响

**问题**：房间反射产生多径，干扰TDOA估计。

**解决**：
- 使用相位变换（PHAT）
- 短时窗处理
- 深度学习去混响

### 6.2 噪声

**问题**：降低信噪比，影响相关峰值。

**解决**：
- 增加麦克风数量
- 时频掩码
- 鲁棒估计

### 6.3 多声源

**问题**：多个源同时存在，相互干扰。

**解决**：
- 子空间方法（MUSIC）
- 稀疏重建
- 深度学习分离+定位

### 6.4 阵列几何

**影响**：
- 孔径越大，分辨率越高
- 麦克风数量越多，鲁棒性越好
- 几何形状影响定位精度

---

## 7. 应用场景

### 7.1 智能音箱

**需求**：
- 实时定位说话人
- 360°覆盖
- 鲁棒性

**方案**：
- 圆形阵列
- SRP-PHAT或深度学习
- 结合波束形成

### 7.2 视频会议

**需求**：
- 多说话人定位
- 摄像头跟踪
- 低延迟

**方案**：
- 线性阵列
- GCC-PHAT + 几何求解
- 卡尔曼滤波平滑

### 7.3 机器人听觉

**需求**：
- 移动平台
- 3D定位
- 实时性

**方案**：
- 3D阵列
- SRP-PHAT
- SLAM融合

### 7.4 监控系统

**需求**：
- 大范围覆盖
- 多目标
- 长时追踪

**方案**：
- 分布式阵列
- 多假设追踪
- 深度学习

---

## 8. 定位与其他任务的关系

```
声源定位
    ↓
    ├──→ 波束形成 (提供DOA)
    ├──→ 说话人追踪 (初始化)
    ├──→ 语音增强 (空间先验)
    └──→ 场景分析 (空间感知)
```

**典型流程**：
1. **定位** → 估计声源方向/位置
2. **波束形成** → 指向目标方向
3. **追踪** → 动态更新位置
4. **增强** → 提取目标语音

---

## 9. 挑战与趋势

### 9.1 当前挑战

1. **混响环境**：强混响下性能下降
2. **移动声源**：实时追踪困难
3. **多声源**：相互干扰
4. **计算复杂度**：实时性要求

### 9.2 发展趋势

1. **深度学习**：端到端学习，处理复杂环境
2. **多模态融合**：结合视觉信息
3. **分布式定位**：多阵列协同
4. **边缘计算**：低功耗实时处理

---

## 10. 学习路径

### 10.1 基础知识
1. 信号处理（相关、频谱）
2. 几何学（三角定位）
3. 线性代数（子空间方法）
4. 概率统计（最大似然）

### 10.2 实践项目
1. 实现GCC-PHAT双麦定位
2. 使用SRP-PHAT进行2D定位
3. 尝试MUSIC算法
4. 训练深度学习定位模型

### 10.3 工具资源
- **pyroomacoustics**：Python声学仿真
- **ODAS**：开源定位系统
- **MATLAB Phased Array Toolbox**
