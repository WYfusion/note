# 谱减法去混响

## 1. 概述

**谱减法 (Spectral Subtraction)** 最初用于噪声抑制，后被扩展到去混响领域。基本思想是在频域估计并减去混响成分。

### 1.1 基本原理

**频域模型**：
$$|Y(\omega)|^2 = |X(\omega)|^2 + |R(\omega)|^2$$

**谱减法**：
$$|\hat{X}(\omega)|^2 = |Y(\omega)|^2 - \alpha|R(\omega)|^2$$

其中 $\alpha$ 是过减因子。

---

## 2. 混响功率谱估计

### 2.1 基于统计的估计

**最小统计**：
$$\hat{P}_R(\omega) = \min_{n \in [n-W, n]} |Y_n(\omega)|^2$$

### 2.2 基于模型的估计

**指数衰减模型**：
$$P_R(\omega, n) = P_R(\omega, n-1) \cdot e^{-\delta} + P_X(\omega, n-1)$$

其中 $\delta = \frac{13.8}{T_{60}}$

---

## 3. 后期混响抑制

### 3.1 时频掩码

**理想比率掩码 (IRM)**：
$$M(\omega, n) = \sqrt{\frac{|X(\omega, n)|^2}{|X(\omega, n)|^2 + |R(\omega, n)|^2}}$$

**应用**：
$$\hat{X}(\omega, n) = M(\omega, n) \cdot Y(\omega, n)$$

### 3.2 维纳滤波

**维纳增益**：
$$G(\omega, n) = \frac{|X(\omega, n)|^2}{|X(\omega, n)|^2 + |R(\omega, n)|^2}$$

---

## 4. 实现

```python
def spectral_subtraction_dereverb(Y_stft, alpha=2.0, beta=0.01):
    """
    谱减法去混响
    
    参数:
        Y_stft: STFT系数 [F, N]
        alpha: 过减因子
        beta: 谱下限
    
    返回:
        X_stft: 去混响后的STFT
    """
    # 估计混响功率谱
    power_Y = np.abs(Y_stft)**2
    power_R = np.minimum.accumulate(power_Y, axis=1)
    
    # 谱减法
    power_X = np.maximum(power_Y - alpha * power_R, beta * power_Y)
    
    # 保持相位
    phase_Y = np.angle(Y_stft)
    X_stft = np.sqrt(power_X) * np.exp(1j * phase_Y)
    
    return X_stft
```

---

## 5. 优缺点

**优点**：
- 计算简单
- 实时性好

**缺点**：
- 音乐噪声
- 需要准确估计混响谱

---

## 参考文献

1. Habets, E. A. (2007). "Single-and multi-microphone speech dereverberation using spectral enhancement."

2. Lebart, K., et al. (2001). "A new method based on spectral subtraction for speech dereverberation."
