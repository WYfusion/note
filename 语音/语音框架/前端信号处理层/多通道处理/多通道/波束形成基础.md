# 波束形成基础 (Beamforming)

波束形成是多通道音频处理中最核心、最经典的技术之一。其基本思想是利用麦克风阵列采集到的多路信号，通过**空间滤波**来增强来自特定方向（期望信号）的声音，同时抑制来自其他方向的干扰和噪声。

## 1. 模型与目标

假设我们有一个 $P$ 个麦克风的阵列，目标是从接收信号 $\mathbf{X}(f, t)$ 中恢复出纯净语音 $S(f, t)$。波束形成器通过对每个麦克风通道的信号进行线性加权求和来实现这一目标。

在频域中，增强后的信号 $\hat{S}(f, t)$ 可以表示为：

$$
\hat{S}(f, t) = \mathbf{w}^H(f) \mathbf{X}(f, t) = \sum_{p=1}^{P} w_p^*(f) X_p(f, t)
$$

其中：
- $\mathbf{w}(f) = [w_1(f), w_2(f), \dots, w_P(f)]^T$ 是一个 $P \times 1$ 维的**复数权重向量**，也称为**滤波器系数**或**波束形成器**。
- $^H$ 表示共轭转置。
- $w_p^*(f)$ 是第 $p$ 个通道的复数权重 $w_p(f)$ 的共轭。
- 这里的时间维度方向各个 $x_p(t)$ 都是共用一个时间的。

在标准的波束形成理论中，$\mathbf{w}(f)$ 确实是一个向量，而不是矩阵。
  解释如下：
   1. 麦克风阵列的每个通道对应一个权重：我们有 $P$ 个麦克风，每个麦克风的信号 $X_p(f, t)$ 都需要乘以一个**标量**复数权重 $w_p(f)$。
   2. 增强信号的计算：增强后的输出信号 $\hat{S}(f, t)$ 是所有通道加权求和的结果：
      $\hat{S}(f, t) = \sum_\limits{p=1}^{P} w_p^*(f) X_p(f, t)$
      将其写成向量形式，就是内积：
      $\hat{S}(f, t) = \mathbf{w}^H(f) \mathbf{X}(f, t)$
      其中 $\mathbf{X}(f, t)$ 是一个 $P \times 1$ 的输入信号向量。为了使得乘法结果是标量 $\hat{S}(f, t)$，$\mathbf{w}^H(f)$ 必须是 $1 \times P$ 的行向量，那么 $\mathbf{w}(f)$ 自然就是 $P \times 1$ 的列向量。
   3. $w_p(f)$ 是标量：$w_p(f)$ 表示在频率 $f$ 上对第 $p$ 个麦克风信号的复杂加权因子（包含幅度和相位），它是一个单一的复数值，因此是标量，而不是向量。

波束形成设计的核心任务就是**求解最优的权重向量 $\mathbf{w}(f)$**，使得输出信号 $\hat{S}(f, t)$ 的信噪比 (SNR) 或其他性能指标最大化。

## 2. 延迟求和波束形成 (Delay-and-Sum Beamforming, DSB)

DSB 是最简单的一种波束形成器，它假设声源位于一个已知的**波达方向** (Direction of Arrival, DOA) $\theta$。

### 核心思想

声波到达不同麦克风的时间会有微小的延迟，这个延迟取决于声源方向和麦克风的几何位置。DSB 的思想是：首先对每个通道的信号进行**时间补偿**，对齐来自目标方向的信号，然后将它们相加。这样，目标信号会因同相叠加而增强，而来自其他方向的噪声则会因相位不一致而部分抵消。

### 时域实现

对于目标方向 $\theta$，声波到达第 $p$ 个麦克风相对于参考麦克风（通常是第1个）的延迟为 $\tau_p(\theta)$。时域 DSB 的操作是：

$$ 
\hat{s}(t) = \frac{1}{P} \sum_{p=1}^{P} x_p(t - \tau_p(\theta)) 
$$ 

### 频域实现

在频域中，时间延迟等效于乘以一个线性相移项 $e^{-j 2\pi f \tau_p(\theta)}$。因此，DSB 的权重向量可以表示为：

$$ 
w_p(f) = \frac{1}{P} e^{-j 2\pi f \tau_p(\theta)} 
$$ 

这个权重向量的作用就是**补偿相位**，使得来自目标方向的信号在所有通道上同相。DSB 的优点是简单、鲁棒，且计算量小。但它的性能有限，尤其是在强混响和强干扰的环境下。

## 3. 滤波器组与阵列响应

波束形成器 $\mathbf{w}(f)$ 的性能可以通过其**阵列响应 (Array Response)** 或**波束方向图 (Beampattern)** 来评估。阵列响应描述了波束形成器对来自不同方向 $\theta$ 的平面波的增益。

对于一个给定的方向 $\theta$，其对应的导向矢量为 $\mathbf{d}(f, \theta)$（这是一个理论上的、无混响情况下的传递函数）。波束形成器在该方向上的响应为：

$$ 
\mathcal{B}(f, \theta) = \mathbf{w}^H(f) \mathbf{d}(f, \theta) 
$$ 

- 当 $\theta$ 是目标方向 $\theta_{target}$ 时，我们希望 $|B(f, \theta_{target})| = 1$，即信号**无失真通过**。
- 当 $\theta$ 是干扰方向 $\theta_{interfere}$ 时，我们希望 $|B(f, \theta_{interfere})| \approx 0$，即形成**零陷 (Null)** 来抑制干扰。

DSB 的波束方向图会形成一个指向目标方向的**主瓣 (Main Lobe)**，但在其他方向上会存在**旁瓣 (Side Lobes)**。这意味着 DSB 虽然能增强目标信号，但对旁瓣方向的噪声抑制能力有限。例如下面的LCMV对于1000hz、2000hz、4000hz、8000hz的不同波束方向图。

![[波束方向图_极坐标_LCMV_M_8_d_mic_1_phi_0.png|600]]

## 4. 从固定到自适应

DSB 是一种**固定波束形成器**，其权重 $\mathbf{w}(f)$ 仅由目标方向决定，与噪声环境无关。为了获得更好的性能，需要根据实时采集到的信号统计特性来动态调整权重，这就是**自适应波束形成 (Adaptive Beamforming)**。自适应算法（如 MVDR）能够根据噪声和干扰的空间分布，在干扰方向上形成更深的零陷，从而实现更出色的降噪效果。
