### 谱减法基本原理
1. 将噪声和语音信号视为相加的关系，也即接收信号中含有加性噪声 $\begin{equation}y(n)=x(n)+e(n)\end{equation}$ ，其对应的离散傅里叶变换为 $Y(\omega)=X(\omega)+E(\omega)$
2. 任务就是将估计到的噪声剔除得到估计的语音信号：$\begin{vmatrix}\hat{X}(\omega)\end{vmatrix}=\begin{vmatrix}Y(\omega)\end{vmatrix}-\begin{vmatrix}E(\omega)\end{vmatrix}$，其中模值$\left|\hat{X}(\omega)\right|=\begin{cases}0\quad\left|\hat{X}(\omega)\right|<0\\\left|\hat{X}(\omega)\right|\quad\text{其他}&\end{cases}$
3. 然后利用原始含噪语音的相位构建其估计语音信号的离散傅里叶变换：$\hat{X}(\omega)=\left|\hat{X}(\omega)\right|e^{j\varphi_Y(\omega)}$
4. 最后使用离散傅里叶逆变换即可得到谱减法之后预估的干净语音：$\hat{x}(n)=\mathrm{IDFT}(\hat{X}(\omega))$


### 实现过程
1. 将输入语音分帧进行短时傅里叶变换([[stft]])
2. 一般可以取前N帧进行噪声估计 $E(\omega)$  简化版本，前20到30帧的各个频率bin的时间轴上的和取平均作为平均的估计的全局噪声(也即将每一帧的噪声都是一样的了)
3. 谱减
4. ISTFT 还原获取干净语音$\hat{x}(n)$

### 任务的关键是噪声的估计
上面的噪声估计方法很简陋，尤其是频率bin下的模值小于0时直接置为0的部分，将会造成转化为时域后变成Sa函数形式，但是经过截断后再计算回stft后将不再是原本的频率bin的阶梯形式跳变，而是有频率上的震荡。
#### 过减法
1. 采用参数控制谱减法的程度和相减采用何种形式(例如幅度谱减法、能量谱减法等等)，$\mathrm{P}_\mathrm{x}(\omega)=\left(P_Y(\omega)^\gamma-\alpha P_Y(\omega)^\gamma\right)^{\frac{1}{\gamma}}$，其中的 $\alpha$ 控制谱减法的噪声被减除的强度(一般取4~6)，$\gamma$ 控制谱减法采用何种形式($\gamma$ 为0.5时就是幅度谱减法，先将能量转化为幅度，再平方)
2. 针对于数值上的保护 $\mathrm{P}_\mathrm{x}(\omega)=\begin{cases}\beta P_e(\omega)&P_X(\omega)<\beta P_e(\omega)\\P_x(\omega)&\text{其他}&&\end{cases}$，这里的 $\beta$ 一般是0.001~0.0001
3. 最后采用 $\begin{vmatrix}\mathrm{X}(\omega)\end{vmatrix}=\sqrt{\mathrm{P}_\mathrm{x}(\omega)}$
引入的新问题是谱线不连续的现象，因此需要进一步的平滑处理：
也可以在做谱减法之前先做一次预平滑处理幅度，沿时间方向平滑幅度谱，降低帧间波动（抑制短时噪声波动、减轻“音乐噪声”），使后续的噪声估计 / 谱减更稳定。
$\max(\omega)=\arg\max\sum_\limits{t=0}^{T_{noise}}E_{\mathfrak{t}}(\omega)-E(\omega)$，其中的 $E(\omega)$ 是前30帧的平均噪声,$E_{\mathfrak{t}}(\omega)$是前30帧的各个频率bin真实值，这样计算出每一个频率bin的最大噪声残差值，以残差值作为检测的阈值，$\begin{vmatrix}\mathrm{X}(\omega)\end{vmatrix}=\begin{cases}\arg\min\sum_\limits{t-k}^{t+k}\begin{vmatrix}\mathrm{X}_t(\omega)\end{vmatrix}&\begin{vmatrix}\mathrm{X}(\omega)\end{vmatrix}<\max(\omega)\\\\\begin{vmatrix}\mathrm{X}(\omega)\end{vmatrix}&\text{其他}&\end{cases}$,如若过减法得到的语音模值比对应的频率bin下的最大噪声残差值还小的话，就认为减的过度了，需要有一定的恢复，恢复方式是采用该时间下的频率bin的前后时间帧的对应频率bin的最小值作为替代。

注意尽管如此还是很有可能出现对于微弱语音信号造成相减后缺失的部分结构的情况。
