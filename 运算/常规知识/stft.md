## STFT公式
$$\mathrm{X}(k)=\sum_{n=0}^{N-1}x(n)e^{-j\frac{2\pi kn}{N}}=\sum_{n=0}^{N-1}x(n)W_N^{nk}$$
stft写成矩阵形式：
$$\mathrm{X=}[x(0),x(1),...,x(N-1)]\begin{bmatrix}\mathrm{W}_N^{0*0}&\mathrm{W}_N^{0*1}&.&\mathrm{W}_N^{0*(N-1)}\\\mathrm{W}_N^{1*0}&\mathrm{W}_N^{1*1}&.&\mathrm{W}_N^{1*(N-1)}\\.&.&.&.\\W_N^{(N-1)*0}&\mathrm{W}_N^{(N-1)*1}&.&\mathrm{W}_N^{(N-1)*(N-1)}\end{bmatrix}$$
维度尺寸是
$$[\mathrm{T,N\_fft}]=[\mathrm{T,N\_fft}]\times[\mathrm{N\_fft,N\_fft}]$$



在短时傅里叶变换 (STFT) 中，`N_FFT` 和 `N_HOP` 是两个重要的参数：

## N_FFT (FFT Length)

- **含义**: FFT 变换的长度，即每次分析的窗口大小（采样点数）
- **作用**:
    - 决定了频域分辨率：N_FFT 越大，频域分辨率越高
    - 影响时域分辨率：N_FFT 越大，时域分辨率越低
- **常见值**: 256, 512, 1024, 2048 等（通常是2的幂次），`FFT_len=512` 表示使用512点的FFT

## FFT_shift (Hop Size/Frame Shift)

- **含义**: 帧移，即相邻两个分析窗口之间的间隔（采样点数）
- **作用**:
    - 控制时域分析的重叠度
    - 影响时域分辨率和计算量
- **常见设置**: 通常为 N_FFT 的 1/2 或 1/4， `FFT_shift=256` 表示每次移动256个采样点

## 关系和影响

1. **重叠度计算**:
    重叠度 = (N_FFT - FFT_shift) / N_FFT
    - 如果 N_FFT=512, FFT_shift=256，则重叠度为 50%
    - 如果 N_FFT=512, FFT_shift=128，则重叠度为 75%
2. **时频分辨率权衡**:
    - **频域分辨率** = 采样率 / N_FFT
    - **时域分辨率** = FFT_shift / 采样率

## 频率分辨率计算

对于32kHz采样率、N_FFT=512的情况：
频率分辨率 = 采样率 / N_FFT = 32000 Hz / 512 = 62.5 Hz

## 理解要点
### 1. **频率分辨率的含义**
- **单位**: Hz（赫兹）
- **含义**: 每个频率bin之间的间隔是62.5Hz
- **不是**将32000Hz划分为512份，而是将**有效频谱范围**划分


- 每个 bin 是一个整数索引 k（k=0,1,...,N_FFT-1）。
- 其对应的中心频率: f_k = k * fs / N_FFT。
- 相邻两个 bin 的间隔（频率分辨率）: Δf = fs / N_FFT。
- 对实数信号，只需前 N_FFT/2 + 1 个 bin（0 到 Nyquist 频率 fs/2）。
- 一个 bin 不是“一个具体单一频率”，而是对该频率段（宽度约 Δf）的能量/复谱估计；我们用它中心频率表示。

### 2. **有效频谱范围**
根据奈奎斯特定理，有效频谱范围是：
- **0 Hz 到 fs/2** = 0 Hz 到 16000 Hz
- 所以实际是将 **16000 Hz** 划分为 **N_FFT/2 + 1 = 257** 个频率bin

### 3. **频率bin分布**
对于32kHz采样率，N_FFT=512
频率bin数量 = 512//2 + 1 = 257个bin
频率范围 = $\text{[0, 62.5, 125, 187.5, ..., 15937.5, 16000]}$ Hz


#### stft的nfft够大且窗移够小，是否能实现一个高质量的时间、频率分辩率？
不能。  
在 STFT 里，时间分辨率 Δt 和频率分辨率 Δf 被“窗口”一次性锁死，二者满足
$Δt · Δf ≥ 1/(4π)$
这个不等式与 nfft、窗移、采样率都无关——它只取决于窗函数的形状和长度。

- 窗长 T 一旦确定，Δt ∝ T，Δf ∝ 1/T 就已经定死。
- 把 nfft 做得再大，只是让频域采样点变密（DFT 的 bin 间隔变小），**并不会缩小主瓣宽度**，也就**不会提高真正的频率分辨能力**；它只能降低“栅栏效应”，看起来平滑而已。
- 把窗移（hop size）做得再小，只是让帧与帧之间重叠变多，**时间网格更细**，但每一帧的局部化能力仍是原来的 Δt，**不会提高真正的时间分辨能力**；它只能减少时间定位的量化误差。

因此，**“nfft 够大且窗移够小”只能得到一张好看、无混叠、无栅栏的 spectrogram，却改变不了窗函数本身决定的时频不确定下限**。要想在低频处有更好的频率分辨、在高频处有更好的时间分辨，就必须跳出固定窗框架，改用可变窗的小波或其它非线性时频分布。